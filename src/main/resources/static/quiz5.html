<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Quiz 5: IT Policies & Compliance - CyberQuizzes</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #0c0c0c 0%, #1a1a2e 50%, #16213e 100%);
            min-height: 100vh;
        }

        .quiz-header {
            background: linear-gradient(90deg, #00b4db 0%, #0083b0 100%);
            color: white;
            padding: 20px 0;
            margin-bottom: 30px;
        }

        .quiz-card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .quiz-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }

        .quiz-card .card-header {
            background: linear-gradient(90deg, #00b4db 0%, #0083b0 100%);
            color: white;
            border-radius: 15px 15px 0 0 !important;
            font-weight: 600;
        }

        .question-number {
            background: #fff;
            color: #00b4db;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 10px;
        }

        .form-check {
            padding: 12px 15px 12px 45px;
            margin: 8px 0;
            border-radius: 10px;
            border: 2px solid #e9ecef;
            transition: all 0.2s;
            cursor: pointer;
        }

        .form-check:hover {
            background-color: #e0f7fa;
            border-color: #00b4db;
        }

        .form-check-input:checked + .form-check-label {
            color: #0083b0;
            font-weight: 600;
        }

        .form-check:has(.form-check-input:checked) {
            background-color: #b2ebf2;
            border-color: #00b4db;
        }

        .form-check-input {
            margin-left: -30px;
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .form-check-input:checked {
            background-color: #00b4db;
            border-color: #00b4db;
        }

        .form-check-label {
            cursor: pointer;
            width: 100%;
        }

        .progress-container {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .progress {
            height: 10px;
            border-radius: 5px;
        }

        .btn-submit {
            background: linear-gradient(90deg, #00b4db 0%, #0083b0 100%);
            border: none;
            padding: 12px 40px;
            font-size: 1.1rem;
            border-radius: 25px;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .btn-submit:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(0, 180, 219, 0.4);
        }

        .btn-back {
            border-radius: 25px;
            padding: 12px 30px;
        }

        .timer-badge {
            font-size: 1.2rem;
            padding: 10px 20px;
            border-radius: 25px;
        }

        .answered-indicator {
            display: none;
            color: #fff;
            margin-left: 10px;
        }

        .quiz-card.answered .answered-indicator {
            display: inline;
        }

        .stats-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            color: white;
            text-align: center;
        }

        .stats-card h3 {
            margin: 0;
            font-size: 2rem;
        }

        .stats-card p {
            margin: 0;
            opacity: 0.8;
        }

        .final-quiz-badge {
            background: rgba(255, 215, 0, 0.2);
            color: #ffd700;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            margin-left: 10px;
        }
    </style>
</head>
<body>

<!-- Header -->
<div class="quiz-header">
    <div class="container">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <h2 class="mb-1">
                    <i class="bi bi-file-earmark-ruled me-2"></i>Quiz 5: IT Policies & Compliance
                    <span class="final-quiz-badge"><i class="bi bi-star-fill me-1"></i>Final Quiz</span>
                </h2>
                <p class="mb-0 opacity-75">Learn about IT policies, compliance standards, and best practices</p>
            </div>
            <div class="d-flex align-items-center gap-3">
                <span id="welcomeMsg" class="d-none d-md-inline"></span>
                <span class="timer-badge bg-light text-dark">
                    <i class="bi bi-clock me-1"></i>
                    <span id="timer">10:00</span>
                </span>
                <button id="logoutBtn" class="btn btn-outline-light btn-sm">
                    <i class="bi bi-box-arrow-right"></i> Logout
                </button>
            </div>
        </div>
    </div>
</div>

<div class="container pb-5">

    <!-- Progress Section -->
    <div class="row mb-4">
        <div class="col-md-8">
            <div class="progress-container">
                <div class="d-flex justify-content-between text-white mb-2">
                    <span><i class="bi bi-list-check me-1"></i> Progress</span>
                    <span><span id="answeredCount">0</span> / 10 Questions Answered</span>
                </div>
                <div class="progress">
                    <div id="progressBar" class="progress-bar" role="progressbar" style="width: 0%; background: linear-gradient(90deg, #00b4db 0%, #0083b0 100%);"></div>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="row g-2">
                <div class="col-6">
                    <div class="stats-card">
                        <h3 id="timeRemaining">10:00</h3>
                        <p><i class="bi bi-hourglass-split"></i> Time Left</p>
                    </div>
                </div>
                <div class="col-6">
                    <div class="stats-card">
                        <h3>10</h3>
                        <p><i class="bi bi-question-circle"></i> Questions</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Quiz Form -->
    <form id="quizForm">

        <!-- Question 1 -->
        <div class="card quiz-card" data-question="1">
            <div class="card-header">
                <span class="question-number">1</span>
                What is an IT policy?
                <i class="bi bi-check-circle-fill answered-indicator"></i>
            </div>
            <div class="card-body">
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q1" id="q1a1" value="1">
                    <label class="form-check-label" for="q1a1">
                        <i class="bi bi-circle me-2"></i>A software installation guide
                    </label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q1" id="q1a2" value="2">
                    <label class="form-check-label" for="q1a2">
                        <i class="bi bi-circle me-2"></i>A set of rules guiding IT usage and security
                    </label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q1" id="q1a3" value="3">
                    <label class="form-check-label" for="q1a3">
                        <i class="bi bi-circle me-2"></i>A programming standard
                    </label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q1" id="q1a4" value="4">
                    <label class="form-check-label" for="q1a4">
                        <i class="bi bi-circle me-2"></i>A password storage method
                    </label>
                </div>
            </div>
        </div>

        <!-- Question 2 -->
        <div class="card quiz-card" data-question="2">
            <div class="card-header">
                <span class="question-number">2</span>
                What is GDPR?
                <i class="bi bi-check-circle-fill answered-indicator"></i>
            </div>
            <div class="card-body">
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q2" id="q2a1" value="1">
                    <label class="form-check-label" for="q2a1">
                        <i class="bi bi-circle me-2"></i>A European data protection regulation
                    </label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q2" id="q2a2" value="2">
                    <label class="form-check-label" for="q2a2">
                        <i class="bi bi-circle me-2"></i>A cloud storage service
                    </label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q2" id="q2a3" value="3">
                    <label class="form-check-label" for="q2a3">
                        <i class="bi bi-circle me-2"></i>A type of firewall
                    </label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q2" id="q2a4" value="4">
                    <label class="form-check-label" for="q2a4">
                        <i class="bi bi-circle me-2"></i>A network protocol
                    </label>
                </div>
            </div>
        </div>

        <!-- Question 3 -->
        <div class="card quiz-card" data-question="3">
            <div class="card-header">
                <span class="question-number">3</span>
                What is the main goal of compliance?
                <i class="bi bi-check-circle-fill answered-indicator"></i>
            </div>
            <div class="card-body">
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q3" id="q3a1" value="1">
                    <label class="form-check-label" for="q3a1">
                        <i class="bi bi-circle me-2"></i>Ensure policies and regulations are followed
                    </label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q3" id="q3a2" value="2">
                    <label class="form-check-label" for="q3a2">
                        <i class="bi bi-circle me-2"></i>Install antivirus software
                    </label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q3" id="q3a3" value="3">
                    <label class="form-check-label" for="q3a3">
                        <i class="bi bi-circle me-2"></i>Encrypt data locally only
                    </label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q3" id="q3a4" value="4">
                    <label class="form-check-label" for="q3a4">
                        <i class="bi bi-circle me-2"></i>Disable firewalls
                    </label>
                </div>
            </div>
        </div>

        <!-- Question 4 -->
        <div class="card quiz-card" data-question="4">
            <div class="card-header">
                <span class="question-number">4</span>
                Which is a compliance standard?
                <i class="bi bi-check-circle-fill answered-indicator"></i>
            </div>
            <div class="card-body">
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q4" id="q4a1" value="1">
                    <label class="form-check-label" for="q4a1">
                        <i class="bi bi-circle me-2"></i>ISO 27001
                    </label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q4" id="q4a2" value="2">
                    <label class="form-check-label" for="q4a2">
                        <i class="bi bi-circle me-2"></i>HTML5
                    </label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q4" id="q4a3" value="3">
                    <label class="form-check-label" for="q4a3">
                        <i class="bi bi-circle me-2"></i>TCP/IP
                    </label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q4" id="q4a4" value="4">
                    <label class="form-check-label" for="q4a4">
                        <i class="bi bi-circle me-2"></i>Bootstrap
                    </label>
                </div>
            </div>
        </div>

        <!-- Question 5 -->
        <div class="card quiz-card" data-question="5">
            <div class="card-header">
                <span class="question-number">5</span>
                What is an acceptable use policy?
                <i class="bi bi-check-circle-fill answered-indicator"></i>
            </div>
            <div class="card-body">
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q5" id="q5a1" value="1">
                    <label class="form-check-label" for="q5a1">
                        <i class="bi bi-circle me-2"></i>Rules for appropriate IT resource usage
                    </label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q5" id="q5a2" value="2">
                    <label class="form-check-label" for="q5a2">
                        <i class="bi bi-circle me-2"></i>A type of firewall
                    </label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q5" id="q5a3" value="3">
                    <label class="form-check-label" for="q5a3">
                        <i class="bi bi-circle me-2"></i>Data encryption method
                    </label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q5" id="q5a4" value="4">
                    <label class="form-check-label" for="q5a4">
                        <i class="bi bi-circle me-2"></i>Cloud storage service
                    </label>
                </div>
            </div>
        </div>

        <!-- Question 6 -->
        <div class="card quiz-card" data-question="6">
            <div class="card-header">
                <span class="question-number">6</span>
                Why are IT audits performed?
                <i class="bi bi-check-circle-fill answered-indicator"></i>
            </div>
            <div class="card-body">
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q6" id="q6a1" value="1">
                    <label class="form-check-label" for="q6a1">
                        <i class="bi bi-circle me-2"></i>Ensure policies and controls are effective
                    </label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q6" id="q6a2" value="2">
                    <label class="form-check-label" for="q6a2">
                        <i class="bi bi-circle me-2"></i>Delete old files
                    </label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q6" id="q6a3" value="3">
                    <label class="form-check-label" for="q6a3">
                        <i class="bi bi-circle me-2"></i>Install software
                    </label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q6" id="q6a4" value="4">
                    <label class="form-check-label" for="q6a4">
                        <i class="bi bi-circle me-2"></i>Reset passwords
                    </label>
                </div>
            </div>
        </div>

        <!-- Question 7 -->
        <div class="card quiz-card" data-question="7">
            <div class="card-header">
                <span class="question-number">7</span>
                What does HIPAA regulate?
                <i class="bi bi-check-circle-fill answered-indicator"></i>
            </div>
            <div class="card-body">
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q7" id="q7a1" value="1">
                    <label class="form-check-label" for="q7a1">
                        <i class="bi bi-circle me-2"></i>Healthcare data privacy & security
                    </label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q7" id="q7a2" value="2">
                    <label class="form-check-label" for="q7a2">
                        <i class="bi bi-circle me-2"></i>Financial transactions
                    </label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q7" id="q7a3" value="3">
                    <label class="form-check-label" for="q7a3">
                        <i class="bi bi-circle me-2"></i>Email marketing
                    </label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q7" id="q7a4" value="4">
                    <label class="form-check-label" for="q7a4">
                        <i class="bi bi-circle me-2"></i>Cloud storage costs
                    </label>
                </div>
            </div>
        </div>

        <!-- Question 8 -->
        <div class="card quiz-card" data-question="8">
            <div class="card-header">
                <span class="question-number">8</span>
                What is RBAC?
                <i class="bi bi-check-circle-fill answered-indicator"></i>
            </div>
            <div class="card-body">
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q8" id="q8a1" value="1">
                    <label class="form-check-label" for="q8a1">
                        <i class="bi bi-circle me-2"></i>Access based on user roles
                    </label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q8" id="q8a2" value="2">
                    <label class="form-check-label" for="q8a2">
                        <i class="bi bi-circle me-2"></i>Random password generation
                    </label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q8" id="q8a3" value="3">
                    <label class="form-check-label" for="q8a3">
                        <i class="bi bi-circle me-2"></i>Installing antivirus
                    </label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q8" id="q8a4" value="4">
                    <label class="form-check-label" for="q8a4">
                        <i class="bi bi-circle me-2"></i>Cloud backup schedules
                    </label>
                </div>
            </div>
        </div>

        <!-- Question 9 -->
        <div class="card quiz-card" data-question="9">
            <div class="card-header">
                <span class="question-number">9</span>
                Why is documentation important?
                <i class="bi bi-check-circle-fill answered-indicator"></i>
            </div>
            <div class="card-body">
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q9" id="q9a1" value="1">
                    <label class="form-check-label" for="q9a1">
                        <i class="bi bi-circle me-2"></i>Ensures procedures are clear & auditable
                    </label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q9" id="q9a2" value="2">
                    <label class="form-check-label" for="q9a2">
                        <i class="bi bi-circle me-2"></i>To confuse users
                    </label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q9" id="q9a3" value="3">
                    <label class="form-check-label" for="q9a3">
                        <i class="bi bi-circle me-2"></i>Store personal emails
                    </label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q9" id="q9a4" value="4">
                    <label class="form-check-label" for="q9a4">
                        <i class="bi bi-circle me-2"></i>Reduce storage space
                    </label>
                </div>
            </div>
        </div>

        <!-- Question 10 -->
        <div class="card quiz-card" data-question="10">
            <div class="card-header">
                <span class="question-number">10</span>
                Best practice for IT compliance?
                <i class="bi bi-check-circle-fill answered-indicator"></i>
            </div>
            <div class="card-body">
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q10" id="q10a1" value="1">
                    <label class="form-check-label" for="q10a1">
                        <i class="bi bi-circle me-2"></i>Policy review, training, audits
                    </label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q10" id="q10a2" value="2">
                    <label class="form-check-label" for="q10a2">
                        <i class="bi bi-circle me-2"></i>Ignore regulations
                    </label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q10" id="q10a3" value="3">
                    <label class="form-check-label" for="q10a3">
                        <i class="bi bi-circle me-2"></i>Share passwords publicly
                    </label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="q10" id="q10a4" value="4">
                    <label class="form-check-label" for="q10a4">
                        <i class="bi bi-circle me-2"></i>Disable logs
                    </label>
                </div>
            </div>
        </div>

        <!-- Submit Buttons -->
        <div class="text-center mt-4 mb-5">
            <button type="button" class="btn btn-secondary btn-back me-3" onclick="window.location.href='quiz.html'">
                <i class="bi bi-arrow-left me-2"></i>Back to Quizzes
            </button>
            <button type="button" class="btn btn-primary btn-submit" onclick="submitQuiz()">
                <i class="bi bi-send me-2"></i>Submit Quiz
            </button>
        </div>

    </form>
</div>

<!-- Result Modal -->
<div class="modal fade" id="resultModal" tabindex="-1" data-bs-backdrop="static">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header" style="background: linear-gradient(90deg, #00b4db 0%, #0083b0 100%); color: white;">
                <h5 class="modal-title"><i class="bi bi-trophy me-2"></i>Quiz Results - Final Quiz!</h5>
            </div>
            <div class="modal-body text-center py-4">
                <div id="resultIcon" style="font-size: 4rem;"></div>
                <h2 id="resultScore" class="my-3"></h2>
                <p id="resultMessage" class="text-muted"></p>
                <div class="progress mt-3" style="height: 25px;">
                    <div id="resultProgress" class="progress-bar" role="progressbar"></div>
                </div>
                <div id="completionBadge" class="mt-4 d-none">
                    <div class="alert alert-success">
                        <i class="bi bi-award-fill me-2" style="font-size: 2rem;"></i>
                        <h5>ðŸŽ‰ Congratulations!</h5>
                        <p class="mb-0">You've completed all CyberQuizzes!</p>
                    </div>
                </div>
            </div>
            <div class="modal-footer justify-content-center">
                <button type="button" class="btn btn-outline-secondary" onclick="window.location.href='quiz.html'">
                    <i class="bi bi-grid me-1"></i>All Quizzes
                </button>
                <button type="button" class="btn text-white" style="background: linear-gradient(90deg, #00b4db 0%, #0083b0 100%);" onclick="location.reload()">
                    <i class="bi bi-arrow-repeat me-1"></i>Retry
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Confetti Canvas -->
<canvas id="confetti-canvas" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 9999;"></canvas>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    const totalQuestions = 10;
    const correctAnswerIndices = [2,1,1,1,1,1,1,1,1,1];
    const quizId = 5;
    let timerInterval;
    let timeLeft = 600;

    $(document).ready(function() {
        checkAuth();
        startTimer();

        $('input[type="radio"]').change(function() {
            const questionNum = $(this).attr('name').replace('q', '');
            $(`.quiz-card[data-question="${questionNum}"]`).addClass('answered');
            updateProgress();
        });
    });

    function checkAuth() {
        $.ajax({
            url: "/api/auth/me",
            type: "GET",
            xhrFields: { withCredentials: true },
            success: function(user) {
                $("#welcomeMsg").text("Hi, " + user.username);
                localStorage.setItem('studentId', user.id);
            },
            error: function() {
                alert("Please log in first.");
                window.location.href = "login.html";
            }
        });
    }

    function startTimer() {
        timerInterval = setInterval(function() {
            timeLeft--;
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            const timeString = `${minutes}:${seconds.toString().padStart(2, '0')}`;

            $("#timer").text(timeString);
            $("#timeRemaining").text(timeString);

            if (timeLeft === 120) {
                $(".timer-badge").removeClass("bg-light text-dark").addClass("bg-warning text-dark");
            }
            if (timeLeft === 60) {
                $(".timer-badge").removeClass("bg-warning").addClass("bg-danger text-white");
            }
            if (timeLeft <= 0) {
                clearInterval(timerInterval);
                alert("Time's up!");
                submitQuiz();
            }
        }, 1000);
    }

    function updateProgress() {
        const answered = $('.quiz-card.answered').length;
        const percentage = (answered / totalQuestions) * 100;
        $('#answeredCount').text(answered);
        $('#progressBar').css('width', percentage + '%');
    }

    function submitQuiz() {
        clearInterval(timerInterval);

        const studentId = localStorage.getItem('studentId');
        if (!studentId) {
            alert("Please log in first!");
            window.location.href = 'login.html';
            return;
        }

        let correctAnswers = 0;
        let answeredCount = 0;

        for (let i = 1; i <= totalQuestions; i++) {
            const selected = document.querySelector(`input[name="q${i}"]:checked`);
            if (selected) {
                answeredCount++;
                if (parseInt(selected.value) === correctAnswerIndices[i-1]) {
                    correctAnswers++;
                }
            }
        }

        if (answeredCount < totalQuestions) {
            alert(`Please answer all questions. You've answered ${answeredCount} of ${totalQuestions}.`);
            return;
        }

        const progress = {
            student: { id: parseInt(studentId) },
            quiz: { id: quizId },
            totalQuestions,
            correctAnswers,
            completed: true
        };

        fetch('/api/quiz-progress/complete', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            credentials: 'include',
            body: JSON.stringify(progress)
        })
            .then(response => response.json())
            .then(() => showResults(correctAnswers))
            .catch(() => showResults(correctAnswers));
    }

    function showResults(score) {
        const percentage = (score / totalQuestions) * 100;
        let icon, message, progressClass;

        if (percentage >= 80) {
            icon = '<i class="bi bi-emoji-laughing text-success"></i>';
            message = "Outstanding! You're an IT compliance expert!";
            progressClass = 'bg-success';
            $('#completionBadge').removeClass('d-none');
            launchConfetti();
        } else if (percentage >= 60) {
            icon = '<i class="bi bi-emoji-smile text-primary"></i>';
            message = "Great work! Keep learning!";
            progressClass = 'bg-primary';
        } else if (percentage >= 40) {
            icon = '<i class="bi bi-emoji-neutral text-warning"></i>';
            message = "Review IT policies and compliance.";
            progressClass = 'bg-warning';
        } else {
            icon = '<i class="bi bi-emoji-frown text-danger"></i>';
            message = "Study up on IT compliance standards!";
            progressClass = 'bg-danger';
        }

        $('#resultIcon').html(icon);
        $('#resultScore').text(`${score} / ${totalQuestions}`);
        $('#resultMessage').text(message);
        $('#resultProgress').css('width', percentage + '%').addClass(progressClass).text(percentage + '%');

        new bootstrap.Modal(document.getElementById('resultModal')).show();
    }

    // Simple confetti effect for high scores
    function launchConfetti() {
        const canvas = document.getElementById('confetti-canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        const particles = [];
        const colors = ['#00b4db', '#0083b0', '#ffd700', '#ff6b6b', '#4ecdc4', '#45b7d1'];

        for (let i = 0; i < 150; i++) {
            particles.push({
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height - canvas.height,
                size: Math.random() * 10 + 5,
                color: colors[Math.floor(Math.random() * colors.length)],
                speedY: Math.random() * 3 + 2,
                speedX: Math.random() * 2 - 1,
                rotation: Math.random() * 360
            });
        }

        function animate() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            particles.forEach((p, index) => {
                p.y += p.speedY;
                p.x += p.speedX;
                p.rotation += 2;

                ctx.save();
                ctx.translate(p.x, p.y);
                ctx.rotate(p.rotation * Math.PI / 180);
                ctx.fillStyle = p.color;
                ctx.fillRect(-p.size / 2, -p.size / 2, p.size, p.size);
                ctx.restore();

                if (p.y > canvas.height) {
                    particles.splice(index, 1);
                }
            });

            if (particles.length > 0) {
                requestAnimationFrame(animate);
            }
        }

        animate();
    }

    $("#logoutBtn").click(function() {
        $.ajax({
            url: "/api/auth/logout",
            type: "POST",
            xhrFields: { withCredentials: true },
            success: function() {
                localStorage.removeItem('studentId');
                window.location.href = "login.html";
            }
        });
    });
</script>
</body>
</html>